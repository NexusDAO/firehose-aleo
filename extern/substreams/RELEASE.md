## Substreams CLI & Lib Release

## Instructions

> *Important* Do not forget to replace `${version}` by your real version like `v0.0.21` in the commands below!

### First Time

We are using https://github.com/goreleaser/goreleaser-cross to run `goreleaser` through Docker, so Docker is required and must be runnong for proper building of the binaries for the different platforms.

You also need to create personal GitHub Token that is able to write to `streamingfast` repositories as well as making GitHub releases. When you have your token which starts with `ghp_`, create at the root of the project a file named `.env.release` with the content:

```
GITHUB_TOKEN=<your_github_token>
```

> **Note** The `bin/release.sh` script checks that the file exists and contains a line `GITHUB_TOKEN=`.

### Preparing for a release

- Ensure tests past `go test ./...`
- Ensure you are in a clean and pushed Git state
- Update the [./docs/release-notes/change-log.md](./docs/release-notes/change-log.md) to update the `## Unreleased` header to become `## [${version}](https://github.com/streamingfast/substreams/releases/tag/v${version})`
- Commit everything with message `Preparing release of ${version}`.

## Generating a Draft release

- `./bin/release.sh -f v${version}`

At this point we have created a release on Github that is in `DRAFT`.

## Finalizing Github release

- Go to https://github.com/streamingfast/substreams-rs/releases and update the release notes, use content of section `## [v${version}]` in [docs/release-notes/change-log.md](./docs/release-notes/change-log.md), edit GitHub release and paste content before commits listing, keep both:

  ```
  ## Changelog

  <Content from 'CHANGELOG.md' here>

  ### Commits

  <Auto-generated commits listing>
  ```
- Update the [docs/release-notes/change-log.md](./docs/release-notes/change-log.md) adding `## Unreleased` header on top of latest released section.
- Commit everything with message `Preparing next unreleased version`.

